{% extends "authenticated.html" %}

{% load people_tags %} 
{% load rules %}


{% block content %}

  {% has_perm 'people.edit_child' user child as edit_child %}  

  {% with object as child %}
    <h1>{{child}}</h1>
<p> classroom: {{child.classroom}}
</p>
<p> parents:
  <ul>
    {% for parent in child.parent_set.all %}
      <li>{% display_user parent %}</li> 
    {% endfor %}
  </ul>
  {% if edit_child %}
    <a href="{% url 'add-parent' child.slug %}">add a parent</a>
  {% endif %}
</p>
{% if child.birthday %}
  <p>
    birthday: {{child.birthday}}
  </p>
{% endif %}
{% endwith %}

{% if edit_child %} 
  {# {% if false %} #}
  worktime preferences:
  {% for pp in prefs_by_period %}
    <li>
      <a href={% url 'submit-preferences' child.slug pp.period.pk %}>
        {{ pp.period.start | date:"j M y"}} - {{ pp.period.end | date:"j M y" }}
      </a>
      
      {% if pp.preferences %}
        {% regroup pp.preferences by rank as prefs_by_rank %}
        <ol>
          {% for rank, prefs in prefs_by_rank %}
            <li>
              {# {{rank}} : #}
              {# <ul> #}
              {% for pref in prefs %}
                {# <li> #}
                {{pref.shift.weekday_str}}
                {{pref.shift.start_time | time:"f"}}
                {% if not forloop.last%},{% endif %}
                {# </li> #}
              {% endfor %}
              {# </ul> #}
            </li>
          {% endfor %}
        </ol>
      {% endif %}
    </li>        
  {% endfor %}
{% endif %}

{% if edit_child %}
  <p>care days:
    <ul>
      {# {% for cda in child.caredayassignment_set.all.distinct %} #}
      {% for cda in child.careday_assignments %}
        <li>
          {{cda.start.date | date:"j M y" }} - {{cda.end.date | date:"j M y"}}:
          {{cda.careday.weekday_str}}, {{cda.careday.start_time}} - {{cda.careday.end_time}}
          [<a href="{% url 'edit-caredayassignment' child.slug cda.pk %}">edit</a>]
          [<a href="{% url 'delete-caredayassignment' child.slug cda.pk %}">delete</a>]
        </li>
      {% endfor %}
    </ul>
    <a href="{% url 'create-careday-assignments' child.slug %}">add care days</a>
  </p>
  
  <p>
    <a href="{% url 'edit-child' child.slug %}">edit child info</a>
  </p>
{% endif %}

{% endblock %}
